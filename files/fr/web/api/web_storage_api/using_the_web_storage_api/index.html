---
title: Using the Web Storage API
slug: Web/API/Web_Storage_API/Using_the_Web_Storage_API
tags:
  - API
  - Guide
  - Storage
  - Web Storage API
  - localStorage
  - sessionStorage
translation_of: Web/API/Web_Storage_API/Using_the_Web_Storage_API
---
<div>{{DefaultAPISidebar("Web Storage API")}}</div><p><span class="seoSummary">L&#39;API de stockage Web fournit des mécanismes par lesquels les navigateurs peuvent stocker en toute sécurité des paires clé / valeur.</span></p><p> Cet article explique comment utiliser cette technologie.</p><h2 id="Basic_concepts"> Concepts de base</h2><p> Les objets de stockage sont de simples magasins de valeurs-clés, similaires aux objets, mais ils restent intacts lors des chargements de page. Les clés et les valeurs sont toujours des chaînes (notez que, comme pour les objets, les clés entières seront automatiquement converties en chaînes). Vous pouvez accéder à ces valeurs comme un objet ou avec le{{domxref("Storage.getItem()")}} et{{domxref("Storage.setItem()")}} méthodes. Ces trois lignes définissent toutes la (même) entrée de couleur.</p><pre class="brush: js" style="white-space: pre;"> localStorage.colorSetting = &#39;# a4509b&#39;;
localStorage [&#39;colorSetting&#39;] = &#39;# a4509b&#39;;
localStorage.setItem (&#39;colorSetting&#39;, &#39;# a4509b&#39;);</pre><div class="note"><p> <strong>Remarque</strong> : il est recommandé d&#39;utiliser l&#39;API de stockage Web ( <code>setItem</code> , <code>getItem</code> , <code>removeItem</code> , <code>key</code> , <code>length</code> ) pour éviter les <a href="http://www.2ality.com/2012/01/objects-as-maps.html">pièges</a> associés à l&#39;utilisation d&#39;objets simples comme magasins clé-valeur.</p></div><p> Les deux mécanismes du stockage Web sont les suivants:</p><ul><li> <strong><code>sessionStorage</code></strong> gère une zone de stockage distincte pour chaque origine donnée qui est disponible pour la durée de la session de page (tant que le navigateur est ouvert, y compris les recharges et les restaurations de page).</li><li> <strong><code>localStorage</code></strong> fait la même chose, mais persiste même lorsque le navigateur est fermé et rouvert.</li></ul><p> Ces mécanismes sont disponibles via le{{domxref("Window.sessionStorage")}} et{{domxref("Window.localStorage")}} properties (pour être plus précis, dans la prise en charge des navigateurs, l&#39;objet <code>Window</code> implémente les objets <code>WindowLocalStorage</code> et <code>WindowSessionStorage</code> , dont les propriétés <code>localStorage</code> et <code>sessionStorage</code> sont membres) - en invoquant l&#39;un d&#39;entre eux, vous créerez une instance du{{domxref("Storage")}} objet, grâce auquel les éléments de données peuvent être définis, récupérés et supprimés. Un objet Storage différent est utilisé pour <code>sessionStorage</code> et <code>localStorage</code> pour chaque origine - ils fonctionnent et sont contrôlés séparément.</p><p> Ainsi, par exemple, appeler initialement <code>localStorage</code> sur un document renverra un{{domxref("Storage")}} objet; l&#39;appel de <code>sessionStorage</code> sur un document renverra un autre{{domxref("Storage")}} objet. Les deux peuvent être manipulés de la même manière, mais séparément.</p><h2 id="Feature-detecting_localStorage"> LocalStorage de détection de fonctionnalités</h2><p> Pour pouvoir utiliser localStorage, nous devons d&#39;abord vérifier qu&#39;il est pris en charge et disponible dans la session de navigation en cours.</p><h3 id="Testing_for_availability"> Test de disponibilité</h3><div class="blockIndicator note"><p> Remarque: cette API est disponible dans les versions actuelles de tous les principaux navigateurs. Le test de disponibilité n&#39;est nécessaire que si vous devez prendre en charge des navigateurs très anciens, tels qu&#39;Internet Explorer 6 ou 7, ou dans les circonstances limitées décrites ci-dessous.</p></div><p> Les navigateurs qui prennent en charge localStorage ont une propriété sur l&#39;objet window nommée <code>localStorage</code> . Cependant, affirmer simplement que cette propriété existe peut lever des exceptions. Si l&#39;objet <code>localStorage</code> existe, il n&#39;y a toujours aucune garantie que l&#39;API localStorage soit réellement disponible, car divers navigateurs proposent des paramètres qui désactivent localStorage. Ainsi, un navigateur peut <em>prendre en charge</em> localStorage, mais ne pas le rendre <em>disponible</em> pour les scripts de la page.</p><p> Par exemple, le navigateur Safari en mode de navigation privée nous donne un objet localStorage vide avec un quota de zéro, ce qui le rend effectivement inutilisable. À l&#39;inverse, nous pourrions obtenir une <code>QuotaExceededError</code> légitime, ce qui signifie que nous avons utilisé tout l&#39;espace de stockage disponible, mais que le stockage <em>est</em> réellement <em>disponible</em> . Notre détection des fonctionnalités doit prendre en compte ces scénarios.</p><p> Voici une fonction qui détecte si localStorage est à la fois pris en charge et disponible:</p><pre class="brush: js"> function storageAvailable (type) {
    stockage var;
    essayez {
        stockage = fenêtre [type];
        var x = &#39;__storage_test__&#39;;
        storage.setItem (x, x);
        storage.removeItem (x);
        retourne vrai;
    }
    catch (e) {
        retourne une instance de DOMException &amp;&amp; (
            // tout sauf Firefox
            e.code === 22 ||
            // Firefox
            e.code === 1014 ||
            // champ de nom de test également, car le code peut ne pas être présent
            // tout sauf Firefox
            e.name === &#39;QuotaExceededError&#39; ||
            // Firefox
            e.name === &#39;NS_ERROR_DOM_QUOTA_REACHED&#39;) &amp;&amp;
            // reconnaît QuotaExceededError uniquement s&#39;il y a quelque chose déjà stocké
            (stockage &amp;&amp; storage.length! == 0);
    }
}</pre><p> Et voici comment vous l&#39;utiliseriez:</p><pre class="brush: js"> if (storageAvailable (&#39;localStorage&#39;)) {
  // Yippee! Nous pouvons utiliser localStorage awesomeness
}
autre {
  // Dommage, pas de stockage local pour nous
}</pre><p> Vous pouvez tester sessionStorage à la place en appelant <code>storageAvailable(&#39;sessionStorage&#39;)</code> .</p><p> Voir ici pour un <a href="https://gist.github.com/paulirish/5558557">bref historique de la détection de fonctionnalités localStorage</a> .</p><h2 id="Example"> Exemple</h2><p> Pour illustrer une utilisation typique du stockage Web, nous avons créé un exemple, appelé de manière imaginative <strong>Web Storage Demo</strong> . La <a href="https://mdn.github.io/dom-examples/web-storage/">page de destination</a> fournit des commandes qui peuvent être utilisées pour personnaliser la couleur, la police et l&#39;image décorative: </p><p><img alt="" src="https://mdn.mozillademos.org/files/9685/landing.png" style="display: block; height: 482px; margin: 0px auto; width: 700px;"> Lorsque vous choisissez différentes options, la page est instantanément mise à jour; De plus, vos choix sont stockés dans <code>localStorage</code> , de sorte que lorsque vous quittez la page et la chargez à nouveau, plus tard, vos choix sont mémorisés.</p><p> Nous avons également fourni une <a href="https://mdn.github.io/dom-examples/web-storage/event.html">page de sortie d&#39;événement</a> - si vous chargez cette page dans un autre onglet, puis modifiez vos choix dans la page de destination, vous verrez les informations de stockage mises à jour affichées sous forme de{{domxref("StorageEvent")}} est viré. </p><p><img alt="" src="https://mdn.mozillademos.org/files/9687/event-output.png" style="display: block; height: 482px; margin: 0px auto; width: 700px;"></p><div class="note"><p> <strong>Remarque</strong> : en plus de visualiser les pages d&#39;exemple en direct à l&#39;aide des liens ci-dessus, vous pouvez également <a href="https://github.com/mdn/dom-examples/tree/master/web-storage">consulter le code source</a> .</p></div><h3 id="Testing_whether_your_storage_has_been_populated"> Tester si votre stockage a été rempli</h3><p> Pour commencer, dans <a href="https://github.com/mdn/dom-examples/blob/master/web-storage/main.js">main.js</a> , nous testons si l&#39;objet de stockage a déjà été rempli (c&#39;est-à-dire que la page a déjà été consultée):</p><pre class="brush: js"> if (! localStorage.getItem (&#39;bgcolor&#39;)) {
  populateStorage ();
} autre {
  setStyles ();
}</pre><p> le{{domxref("Storage.getItem()")}} méthode est utilisée pour extraire un élément de données du stockage; dans ce cas, nous testons pour voir si l&#39;élément <code>bgcolor</code> existe; sinon, nous exécutons <code>populateStorage()</code> pour ajouter les valeurs de personnalisation existantes au stockage. S&#39;il y a déjà des valeurs, nous <code>setStyles()</code> pour mettre à jour le style de page avec les valeurs stockées.</p><p> <strong>Remarque</strong> : vous pouvez également utiliser{{domxref("Storage.length")}} pour tester si l&#39;objet de stockage est vide ou non.</p><h3 id="Getting_values_from_storage"> Obtenir des valeurs du stockage</h3><p> Comme indiqué ci-dessus, les valeurs peuvent être extraites du stockage en utilisant{{domxref("Storage.getItem()")}} . Cela prend la clé de l&#39;élément de données comme argument et renvoie la valeur des données. Par exemple:</p><pre class="brush: js"> function setStyles () {
  var currentColor = localStorage.getItem (&#39;bgcolor&#39;);
  var currentFont = localStorage.getItem (&#39;font&#39;);
  var currentImage = localStorage.getItem (&#39;image&#39;);

  document.getElementById (&#39;bgcolor&#39;). value = currentColor;
  document.getElementById (&#39;font&#39;). value = currentFont;
  document.getElementById (&#39;image&#39;). value = currentImage;

  htmlElem.style.backgroundColor = &#39;#&#39; + currentColor;
  pElem.style.fontFamily = currentFont;
  imgElem.setAttribute (&#39;src&#39;, currentImage);
}</pre><p> Ici, les trois premières lignes récupèrent les valeurs du stockage local. Ensuite, nous définissons les valeurs affichées dans les éléments de formulaire sur ces valeurs, afin qu&#39;elles restent synchronisées lorsque vous rechargez la page. Enfin, nous mettons à jour les styles / image décorative sur la page, afin que vos options de personnalisation reviennent lors du rechargement.</p><h3 id="Setting_values_in_storage"> Définition des valeurs dans le stockage</h3><p>{{domxref("Storage.setItem()")}} est utilisé à la fois pour créer de nouveaux éléments de données et (si l&#39;élément de données existe déjà) pour mettre à jour les valeurs existantes. Cela prend deux arguments: la clé de l&#39;élément de données à créer / modifier et la valeur à y stocker.</p><pre class="brush: js"> function populateStorage () {
  localStorage.setItem (&#39;bgcolor&#39;, document.getElementById (&#39;bgcolor&#39;). value);
  localStorage.setItem (&#39;font&#39;, document.getElementById (&#39;font&#39;). value);
  localStorage.setItem (&#39;image&#39;, document.getElementById (&#39;image&#39;). value);

  setStyles ();
}</pre><p> La fonction <code>populateStorage()</code> définit trois éléments dans le stockage local: la couleur d&#39;arrière-plan, la police et le chemin de l&#39;image. Il exécute ensuite la fonction <code>setStyles()</code> pour mettre à jour les styles de page, etc.</p><p> Nous avons également inclus un gestionnaire <code>onchange</code> sur chaque élément de formulaire afin que les données et le style soient mis à jour chaque fois qu&#39;une valeur de formulaire est modifiée:</p><pre class="brush: js"> bgcolorForm.onchange = populateStorage;
fontForm.onchange = populateStorage;
imageForm.onchange = populateStorage;</pre><h3 id="Responding_to_storage_changes_with_the_StorageEvent"> Répondre aux changements de stockage avec StorageEvent</h3><p> le{{domxref("StorageEvent")}} est déclenché chaque fois qu&#39;une modification est apportée au{{domxref("Storage")}} object (notez que cet événement n&#39;est pas déclenché pour les modifications de sessionStorage). Cela ne fonctionnera pas sur la même page qui effectue les modifications - c&#39;est vraiment un moyen pour les autres pages du domaine utilisant le stockage de synchroniser les modifications apportées. Les pages d&#39;autres domaines ne peuvent pas accéder aux mêmes objets de stockage.</p><p> Sur la page des événements (voir <a href="https://github.com/mdn/dom-examples/blob/master/web-storage/event.js">events.js</a> ), le seul JavaScript est le suivant:</p><pre class="brush: js"> window.addEventListener (&#39;stockage&#39;, fonction (e) {
  document.querySelector (&#39;. ma-clé&#39;). textContent = e.key;
  document.querySelector (&#39;. mon-ancien&#39;). textContent = e.oldValue;
  document.querySelector (&#39;. my-new&#39;). textContent = e.newValue;
  document.querySelector (&#39;. mon-url&#39;). textContent = e.url;
  document.querySelector (&#39;. my-storage&#39;). textContent = JSON.stringify (e.storageArea);
});</pre><p> Ici, nous ajoutons un écouteur d&#39;événement à l&#39;objet <code>window</code> qui se déclenche lorsque le{{domxref("Storage")}} l&#39;objet associé à l&#39;origine actuelle est modifié. Comme vous pouvez le voir ci-dessus, l&#39;objet événement associé à cet événement a un certain nombre de propriétés contenant des informations utiles - la clé des données qui ont changé, l&#39;ancienne valeur avant la modification, la nouvelle valeur après cette modification, l&#39;URL du document qui a changé le stockage et l&#39;objet de stockage lui-même (que nous avons stringifié pour que vous puissiez voir son contenu).</p><h3 id="Deleting_data_records"> Supprimer des enregistrements de données</h3><p> Le stockage Web fournit également quelques méthodes simples pour supprimer des données. Nous ne les utilisons pas dans notre démo, mais ils sont très simples à ajouter à votre projet:</p><ul><li>{{domxref("Storage.removeItem()")}} prend un seul argument - la clé de l&#39;élément de données que vous souhaitez supprimer - et le supprime de l&#39;objet de stockage pour ce domaine.</li><li>{{domxref("Storage.clear()")}} ne prend aucun argument et vide simplement l&#39;objet de stockage entier pour ce domaine.</li></ul><h2 id="Specifications"> Caractéristiques</h2><table class="standard-table"><thead><tr><th scope="col"> spécification</th><th scope="col"> Statut</th><th scope="col"> Commentaire </th></tr></thead><tbody><tr><td>{{SpecName('HTML WHATWG', 'webstorage.html#webstorage')}}</td><td>{{Spec2('HTML WHATWG')}}</td><td></td></tr></tbody></table><h2 id="Browser_compatibility"> Compatibilité du navigateur</h2><h3 id="Window.localStorage"> <code>Window.localStorage</code></h3><div><p>{{Compat("api.Window.localStorage")}}</p><h3 id="Window.sessionStorage"> <code>Window.sessionStorage</code></h3><div><div class="hidden"> Le tableau de compatibilité de cette page est généré à partir de données structurées. Si vous souhaitez contribuer aux données, veuillez consulter <a href="https://github.com/mdn/browser-compat-data">https://github.com/mdn/browser-compat-data</a> et nous envoyer une pull request.</div><p>{{Compat("api.Window.sessionStorage")}}</p></div></div><p> Tous les navigateurs ont des niveaux de capacité variables pour localStorage et sessionStorage. Voici un <a class="external" href="http://dev-test.nemikor.com/web-storage/support-test/" title="http://dev-test.nemikor.com/web-storage/support-test/">aperçu détaillé de toutes les capacités de stockage pour différents navigateurs</a> .</p><h2 id="See_also"> Voir également</h2><ul><li> <a href="/en-US/docs/Web/API/Web_Storage_API">Page de destination de l&#39;API de stockage Web</a></li></ul>
